(env
 (dev
  (flags
   (:standard -w -9-27-32))))

(executable
 (name main)
 (modules main)
 (libraries curly yojson))

(library
 (name diff_parser)
 (modules types line_parser diff_parser)
 (wrapped false)
 (libraries
  opal
  ;mparser
  angstrom
  stdio
  yojson
  ppx_show.runtime
  camlp-streams)
 (inline_tests)
 (preprocessor_deps blob1.diff)
 (preprocess
  (pps ppx_inline_test ppx_blob ppx_show ppx_expect)))

(executable
 (name parser)
 (modules parser)
 (libraries diff_parser)
 (preprocess
  (pps ppx_show)))

; (copy_files ./old)

(cram
 (deps
  (source_tree old)
  (source_tree new)
  ./blob1.diff
  ./main.exe
  ./parser.exe
  ;
  ))
